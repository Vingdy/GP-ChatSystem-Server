#!/bin/bash

# 编译代码
#docker run \
#  -v $PWD:GP \
#  -w GP \
#  -p 80:80 \
#  golang:apline go build

IMAGE="ccr.ccs.tencentyun.com/go_gp/go_gp:latest"

docker stop go_gp || true && docker rm go_gp || true
#NAME="go_gp"
#if docker ps | awk -v NAME="$NAME" 'NR > 1 && $NF == NAME{ret=1; exit} END{exit !ret}'; then
#  docker stop "$NAME" && docker rm -f "$NAME"
#fi


# 编译镜像
docker build -t $IMAGE .

docker run -d --name=go_gp --rm -p 80:80 $IMAGE

#docker tag 705105278/go_gp $IMAGES

# 上传镜像 (请提前登录好,docker login 只需登录一次)
docker push $IMAGE

# 清理
docker rmi $IMAGE

#rm GP
